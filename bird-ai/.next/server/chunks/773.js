"use strict";exports.id=773,exports.ids=[773],exports.modules={87773:(t,e,i)=>{let s=i(13e3),{withAutomaticRetries:n}=i(1956),r=i(8201),a=i(31789),o=i(1815),c=i(51562),l=i(79723),d=i(69637);t.exports=class{constructor(t={}){this.auth=t.auth||process.env.REPLICATE_API_TOKEN,this.userAgent=t.userAgent||`replicate-javascript/${d.version}`,this.baseUrl=t.baseUrl||"https://api.replicate.com/v1",this.fetch=t.fetch||globalThis.fetch,this.collections={list:r.list.bind(this),get:r.get.bind(this)},this.models={get:o.get.bind(this),list:o.list.bind(this),versions:{list:o.versions.list.bind(this),get:o.versions.get.bind(this)}},this.predictions={create:c.create.bind(this),get:c.get.bind(this),cancel:c.cancel.bind(this),list:c.list.bind(this)},this.trainings={create:l.create.bind(this),get:l.get.bind(this),cancel:l.cancel.bind(this),list:l.list.bind(this)},this.deployments={predictions:{create:a.predictions.create.bind(this)}}}async run(t,e,i){let{wait:s,...n}=e,r=/[a-zA-Z0-9]+(?:(?:[._]|__|[-]*)[a-zA-Z0-9]+)*/,a=RegExp(`^(?<owner>${r.source})/(?<name>${r.source}):(?<version>[0-9a-fA-F]+)$`),o=t.match(a);if(!o||!o.groups)throw Error('Invalid version. It must be in the format "owner/name:version"');let{version:c}=o.groups,l=await this.predictions.create({...n,version:c});i&&i(l);let{signal:d}=e;if(l=await this.wait(l,s||{},async t=>(i&&i(t),!!d&&!!d.aborted&&(await this.predictions.cancel(t.id),!0))),i&&i(l),"failed"===l.status)throw Error(`Prediction failed: ${l.error}`);return l.output}async request(t,e){let i;let{auth:r,baseUrl:a,userAgent:o}=this;i=t instanceof URL?t:new URL(t.startsWith("/")?t.slice(1):t,a.endsWith("/")?a:`${a}/`);let{method:c="GET",params:l={},data:d}=e;Object.entries(l).forEach(([t,e])=>{i.searchParams.append(t,e)});let h=new Headers;r&&h.append("Authorization",`Token ${r}`),h.append("Content-Type","application/json"),h.append("User-Agent",o),e.headers&&e.headers.forEach((t,e)=>{h.append(e,t)});let u={method:c,headers:h,body:d?JSON.stringify(d):void 0},p=await n(async()=>this.fetch(i,u),{shouldRetry:"GET"===c?t=>429===t.status||t.status>=500:t=>429===t.status});if(!p.ok){let t=new Request(i,u),e=await p.text();throw new s(`Request to ${i} failed with status ${p.status} ${p.statusText}: ${e}.`,t,p)}return p}async *paginate(t){let e=await t();yield e.results,e.next&&(yield*this.paginate(()=>this.request(e.next,{method:"GET"}).then(t=>t.json())))}async wait(t,e,i){let{id:s}=t;if(!s)throw Error("Invalid prediction");if("succeeded"===t.status||"failed"===t.status||"canceled"===t.status)return t;let sleep=t=>new Promise(e=>setTimeout(e,t)),n=e&&e.interval||500,r=await this.predictions.get(s);for(;"succeeded"!==r.status&&"failed"!==r.status&&"canceled"!==r.status&&(!i||await i(r)!==!0);)await sleep(n),r=await this.predictions.get(t.id);if("failed"===r.status)throw Error(`Prediction failed: ${r.error}`);return r}}},8201:t=>{async function getCollection(t){let e=await this.request(`/collections/${t}`,{method:"GET"});return e.json()}async function listCollections(){let t=await this.request("/collections",{method:"GET"});return t.json()}t.exports={get:getCollection,list:listCollections}},31789:t=>{async function createPrediction(t,e,i){let{stream:s,...n}=i;if(n.webhook)try{new URL(n.webhook)}catch(t){throw Error("Invalid webhook URL")}let r=await this.request(`/deployments/${t}/${e}/predictions`,{method:"POST",data:{...n,stream:s}});return r.json()}t.exports={predictions:{create:createPrediction}}},13e3:t=>{t.exports=class extends Error{constructor(t,e,i){super(t),this.name="ApiError",this.request=e,this.response=i}}},1815:t=>{async function getModel(t,e){let i=await this.request(`/models/${t}/${e}`,{method:"GET"});return i.json()}async function listModelVersions(t,e){let i=await this.request(`/models/${t}/${e}/versions`,{method:"GET"});return i.json()}async function getModelVersion(t,e,i){let s=await this.request(`/models/${t}/${e}/versions/${i}`,{method:"GET"});return s.json()}async function listModels(){let t=await this.request("/models",{method:"GET"});return t.json()}t.exports={get:getModel,list:listModels,versions:{list:listModelVersions,get:getModelVersion}}},51562:t=>{async function createPrediction(t){let{stream:e,...i}=t;if(i.webhook)try{new URL(i.webhook)}catch(t){throw Error("Invalid webhook URL")}let s=await this.request("/predictions",{method:"POST",data:{...i,stream:e}});return s.json()}async function getPrediction(t){let e=await this.request(`/predictions/${t}`,{method:"GET"});return e.json()}async function cancelPrediction(t){let e=await this.request(`/predictions/${t}/cancel`,{method:"POST"});return e.json()}async function listPredictions(){let t=await this.request("/predictions",{method:"GET"});return t.json()}t.exports={create:createPrediction,get:getPrediction,cancel:cancelPrediction,list:listPredictions}},79723:t=>{async function createTraining(t,e,i,s){let{...n}=s;if(n.webhook)try{new URL(n.webhook)}catch(t){throw Error("Invalid webhook URL")}let r=await this.request(`/models/${t}/${e}/versions/${i}/trainings`,{method:"POST",data:n});return r.json()}async function getTraining(t){let e=await this.request(`/trainings/${t}`,{method:"GET"});return e.json()}async function cancelTraining(t){let e=await this.request(`/trainings/${t}/cancel`,{method:"POST"});return e.json()}async function listTrainings(){let t=await this.request("/trainings",{method:"GET"});return t.json()}t.exports={create:createTraining,get:getTraining,cancel:cancelTraining,list:listTrainings}},1956:(t,e,i)=>{let s=i(13e3);async function withAutomaticRetries(t,e={}){let i=e.shouldRetry||(()=>!1),n=e.maxRetries||5,r=e.interval||500,a=e.jitter||100,sleep=t=>new Promise(e=>setTimeout(e,t)),o=0;do{let c=r*2**o+Math.random()*a;try{let e=await t();if(e.ok||!i(e))return e}catch(t){if(t instanceof s){let e=t.response.headers.get("Retry-After");if(e){if(Number.isInteger(e))c=1e3*e;else{let t=new Date(e);Number.isNaN(t.getTime())||(c=t.getTime()-new Date().getTime())}}}}Number.isInteger(n)&&n>0&&(Number.isInteger(c)&&c>0&&await sleep(r*2**(e.maxRetries-n)),o+=1)}while(o<n);return t()}t.exports={withAutomaticRetries}},69637:t=>{t.exports=JSON.parse('{"name":"replicate","version":"0.20.0","description":"JavaScript client for Replicate","repository":"github:replicate/replicate-javascript","homepage":"https://github.com/replicate/replicate-javascript#readme","bugs":"https://github.com/replicate/replicate-javascript/issues","license":"Apache-2.0","main":"index.js","engines":{"node":">=18.0.0","npm":">=7.19.0","git":">=2.11.0","yarn":">=1.7.0"},"scripts":{"check":"tsc","lint":"eslint .","test":"jest"},"devDependencies":{"@types/jest":"^29.5.3","@typescript-eslint/eslint-plugin":"^5.56.0","cross-fetch":"^3.1.5","eslint":"^8.36.0","eslint-config-airbnb-base":"^15.0.0","eslint-plugin-import":"^2.27.5","eslint-plugin-jest":"^27.2.1","eslint-plugin-jsdoc":"^46.2.6","eslint-plugin-n":"^15.6.1","eslint-plugin-promise":"^6.1.1","jest":"^29.6.2","nock":"^13.3.0","ts-jest":"^29.1.0","typescript":"^5.0.2"}}')}};